<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Key Generator ‚Äî Dark</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#080007;
    --bg2:#13001a;
    --glow:#c300ff;
    --muted:#b8a3d9;
    --card:#0f0912;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: "Orbitron", monospace;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(195,0,255,0.08), transparent),
                linear-gradient(135deg,var(--bg1),var(--bg2));
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .shell{
    width:min(820px,94%);
    padding:28px;
    border-radius:14px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    box-shadow:0 8px 40px rgba(0,0,0,0.6), 0 0 40px rgba(195,0,255,0.08);
    border:1px solid rgba(255,255,255,0.03);
    display:grid;
    grid-template-columns: 1fr 380px;
    gap:22px;
    align-items:center;
    position:relative;
    overflow:hidden;
  }

  /* left: terminal style */
  .terminal{
    padding:22px;
    background: linear-gradient(180deg, rgba(0,0,0,0.5), rgba(10,0,10,0.4));
    border-radius:10px;
    min-height:220px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    gap:12px;
    box-shadow: inset 0 0 40px rgba(195,0,255,0.02);
  }
  .small { color:var(--muted); font-size:13px; opacity:0.9; }
  .status { color:#9ff; font-size:14px; }
  .keybox{
    margin-top:6px;
    padding:18px;
    background:linear-gradient(90deg, rgba(16,10,16,0.6), rgba(8,3,12,0.75));
    border-radius:8px;
    border:1px solid rgba(195,0,255,0.12);
    font-size:20px;
    letter-spacing:1px;
    color:var(--glow);
    text-shadow:0 0 18px rgba(195,0,255,0.9);
    word-break:break-all;
    min-height:56px;
    display:flex;
    align-items:center;
  }

  /* right: controls */
  .controls{
    padding:18px;
    border-radius:10px;
    background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.005));
    display:flex;
    flex-direction:column;
    gap:14px;
    align-items:stretch;
  }
  .brand{
    display:flex;
    gap:10px;
    align-items:center;
  }
  .logo{
    width:46px;height:46px;border-radius:10px;
    background:linear-gradient(135deg,#300039,#8a00b3);
    box-shadow:0 6px 18px rgba(138,0,179,0.15), inset 0 -6px 18px rgba(0,0,0,0.2);
    display:flex;align-items:center;justify-content:center;font-weight:700;
  }
  h1{font-size:16px;margin:0;color:#fff}
  .sub{font-size:12px;color:var(--muted)}

  .bigbtn{
    margin-top:8px;
    padding:14px 18px;
    border-radius:10px;
    border:0;
    background: linear-gradient(90deg,var(--glow),#8a00b3);
    color:#0b0010;
    font-weight:700;
    cursor:pointer;
    box-shadow:0 8px 30px rgba(195,0,255,0.12);
    transition:transform .12s ease;
  }
  .bigbtn:active{transform:scale(.98)}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:10px;border-radius:8px;cursor:pointer}

  .meta{font-size:13px;color:var(--muted);display:flex;justify-content:space-between;gap:8px}

  .countdown{font-size:13px;color:#9ff;font-weight:700}

  /* responsive */
  @media (max-width:880px){
    .shell{grid-template-columns:1fr; padding:20px}
    .controls{order:2}
  }
</style>
</head>
<body>
  <div class="shell">
    <div class="terminal">
      <div class="brand small"><span class="small">üîê</span><div style="width:8px"></div><div class="small">Secure Key Terminal</div></div>
      <div class="status">> Generating secure key... <span id="dot" style="opacity:.6">.</span></div>
      <div class="keybox" id="keyDisplay">‚Äî</div>
      <div class="meta">
        <div class="small">Status: <span id="statusText">Loading</span></div>
        <div class="countdown" id="countdown">‚Äî</div>
      </div>
    </div>

    <div class="controls">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <div>
          <div class="brand">
            <div class="logo">K</div>
            <div>
              <h1>Key Generator</h1>
              <div class="sub">Dark Futuristic ‚Ä¢ Secure</div>
            </div>
          </div>
        </div>
        <div style="text-align:right">
          <div class="sub">v1.0</div>
          <div class="sub" style="margin-top:6px">IP cooldown: 30m</div>
        </div>
      </div>

      <button class="bigbtn" id="refreshBtn">Generate / Refresh</button>
      <div style="display:flex;gap:8px">
        <button id="copyBtn" class="ghost">Copy</button>
        <button id="openBtn" class="ghost" onclick="window.open('https://t.me/+S145y8OSyJdmZjdk','_blank')">Support</button>
      </div>

      <div style="font-size:13px;color:var(--muted);margin-top:6px">
        Tips: Clearing cookies won't bypass IP-based cooldown. If you need another key, wait the shown time or contact support.
      </div>
    </div>
  </div>

<script>
  // little dot anim
  let d=0; setInterval(()=>{ d=(d+1)%4; document.getElementById('dot').innerText='.'.repeat(d) },400);

  async function getKey() {
    const el = document.getElementById('keyDisplay');
    const status = document.getElementById('statusText');
    const cd = document.getElementById('countdown');
    status.innerText='Requesting';
    try {
      const res = await fetch('/api/key', {cache:'no-store'});
      const j = await res.json();
      if (j.error) {
        el.innerText = j.error;
        status.innerText='Error';
        cd.innerText = '';
        return;
      }
      if (j.code) {
        el.innerText = j.code;
        status.innerText = j.remainingMinutes && j.remainingMinutes>0 ? 'On cooldown' : 'OK';
        startCountdown(j.remainingMinutes || 0);
      } else {
        el.innerText='No code available';
        status.innerText='Empty';
      }
    } catch (e) {
      el.innerText='Network error';
      status.innerText='Offline';
      console.error(e);
    }
  }

  // countdown in mm:ss from minutes value
  let countdownTimer = null;
  function startCountdown(minutes) {
    clearInterval(countdownTimer);
    const target = Date.now() + (minutes*60000);
    if (!minutes || minutes<=0) {
      document.getElementById('countdown').innerText = 'Ready';
      return;
    }
    countdownTimer = setInterval(()=>{
      const ms = target - Date.now();
      if (ms <= 0) { clearInterval(countdownTimer); document.getElementById('countdown').innerText='Ready'; return; }
      const m = Math.floor(ms/60000); const s = Math.floor((ms%60000)/1000);
      document.getElementById('countdown').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    },300);
  }

  document.getElementById('refreshBtn').addEventListener('click', getKey);
  document.getElementById('copyBtn').addEventListener('click', ()=>{
    const k = document.getElementById('keyDisplay').innerText.split('\n')[0] || '';
    navigator.clipboard.writeText(k.trim()).then(()=> alert('Copied'));
  });

  // load on start
  getKey();
</script>
</body>
</html>
